# FortCov

A coverage analysis tool specifically designed for Fortran projects, processing coverage data from gfortran to generate comprehensive reports.

## Features

- **Native Fortran Support**: Built specifically for Fortran projects with understanding of modules, contains blocks, and interfaces
- **GCC/gfortran Integration**: Processes binary coverage data (.gcno/.gcda files) generated by gfortran with coverage flags
- **Markdown Reports**: Generates clean, readable markdown coverage reports suitable for documentation and CI/CD
- **Extensible Architecture**: Clean abstractions allow easy addition of new input formats and output reporters
- **Test-Driven Development**: Comprehensive test suite ensures reliability

## Installation

### Prerequisites

- Fortran compiler (gfortran recommended)
- [Fortran Package Manager (fpm)](https://github.com/fortran-lang/fpm)

### Building from Source

```bash
git clone https://github.com/yourusername/fortcov.git
cd fortcov
fpm build --profile release
```

## Usage

### Generating Coverage Data

First, compile your Fortran code with coverage flags:

```bash
gfortran -fprofile-arcs -ftest-coverage your_code.f90 -o your_program
./your_program  # Run to generate coverage data
```

This creates `.gcno` (compile-time) and `.gcda` (runtime) files.

### Running FortCov

```bash
fortcov your_code.gcno  # Analyze coverage data
```

This generates a markdown report showing:
- Line coverage percentages
- Missing line ranges
- File and total summaries

### Example Output

```markdown
| Filename                          |   Stmts |   Miss | Cover   | Missing            |
|-----------------------------------|---------|--------|---------|--------------------|
| src/module_a.f90                  |     100 |     10 | 90.00%  | 45-48, 72-77       |
| src/module_b.f90                  |      50 |      0 | 100.00% |                    |
| TOTAL                             |     150 |     10 | 93.33%  |                    |
```

## Development

### Building and Testing

```bash
# Build the project
fpm build

# Run tests
fpm test

# Build with coverage
fpm build --flag "-fprofile-arcs -ftest-coverage"
fpm test --flag "-fprofile-arcs -ftest-coverage"
```

### Project Structure

```
fortcov/
├── src/                    # Core library modules
│   ├── coverage_model.f90      # Data structures
│   ├── coverage_parser.f90     # Parser abstraction
│   ├── gcov_binary_format.f90  # Binary format parser
│   ├── coverage_statistics.f90 # Metric calculations
│   ├── coverage_reporter.f90   # Reporter abstraction
│   └── markdown_reporter.f90   # Markdown generation
├── app/                    # Main executable
│   └── main.f90
├── test/                   # Test suite
│   └── test_*.f90
└── fpm.toml               # Package configuration
```

## Architecture

FortCov follows SOLID principles with clean separation of concerns:

1. **Parsers**: Convert various coverage formats to unified internal model
2. **Model**: Unified representation of coverage data
3. **Statistics**: Calculate coverage metrics
4. **Reporters**: Generate reports in various formats

See [DESIGN.md](DESIGN.md) for detailed architecture documentation.

## Contributing

Contributions are welcome! Please ensure:

1. Follow Test-Driven Development (TDD)
2. Write tests first (RED phase)
3. Implement minimal code to pass (GREEN phase)
4. Refactor while keeping tests green
5. Keep functions small and focused
6. Follow existing code style (88 char lines, 4-space indent)

## Roadmap

### Current (MVP)
- [x] GCC/gfortran binary format support
- [x] Markdown report generation
- [x] Basic line coverage
- [ ] Command-line interface
- [ ] Configuration file support

### Future Enhancements
- [ ] HTML reports with syntax highlighting
- [ ] Cobertura XML format
- [ ] LCOV info format
- [ ] Coverage diff between commits
- [ ] Intel Fortran compiler support
- [ ] Flang/LLVM coverage support

## License

[To be determined]

## Acknowledgments

- Inspired by gcovr and lcov but designed specifically for Fortran
- Built with modern Fortran best practices
- Uses Fortran Package Manager (fpm) for build management